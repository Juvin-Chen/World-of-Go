# Unicode、UTF、文件编码与源码编码 核心笔记

## 一、核心逻辑总览

1. 本质关系：**Unicode是字符的“全球唯一身份证号”**，UTF是“把身份证号转成电脑可存字节的规则”，文件编码是“选择哪套规则存储文件”，源码编码是“编程语言规定用哪套规则解析源码文件”。

2. 核心链路：字符 → Unicode码点（身份证）→ UTF编码（转字节）→ 文件编码（按规则存硬盘）→ 编程语言解析（按源码编码规则读字节）。

## 二、基础编码概念拆解

### 1. ASCII 编码（初代极简版）

- **本质**：仅覆盖英文、数字、常用标点、控制符的字符-数字映射表，共128个字符（编号0~127）。

- **存储**：1字节（8位）存储，仅用低7位，最高位固定为0（如“A”→65→二进制01000001）。

- **缺点**：无法表示中文、日文、Emoji等非英文字符，易出现乱码。

### 2. Unicode 编码（全球统一编号系统）

- **本质**：给全球所有字符（英文、中文、Emoji、生僻字）分配唯一“码点”（格式U+xxxx，如“中”→U+4E2D→十进制20013），解决多编码体系乱码问题。

- **与ASCII的关系**：完全包含ASCII，前128个码点（0~127）与ASCII完全重合，兼容老系统。

- **码点范围**：
        

  - 基本多文种平面（BMP）：U+0000~U+FFFF（0~65535），2字节可表示，含常用字符；

  - 辅助平面：U+10000~U+10FFFF（65536~1114111），需3~4字节表示，含Emoji、生僻字。

- **关键提醒**：Unicode仅定义“字符-码点”映射，不规定码点如何存储为字节（需UTF解决）。

### 3. UTF 编码家族（Unicode转字节的规则）

UTF（Unicode Transformation Format）是一套“将Unicode码点转换为字节序列”的编码规则，核心解决“码点如何存储”的问题，主流成员如下：

| 编码类型        | 存储方式              | 核心特点                                                     | 适用场景                              |
| --------------- | --------------------- | ------------------------------------------------------------ | ------------------------------------- |
| UTF-8（最常用） | 变长编码（1~4字节）   | 1. ASCII字符→1字节（与ASCII兼容）；2. 中文/日文→3字节；3. Emoji/生僻字→4字节；4. 无字节序问题，跨平台友好。 | Go语言、网页、Linux、绝大多数现代场景 |
| UTF-16          | 混合编码（2或4字节）  | 1. 常用字符→2字节；2. 辅助平面字符→4字节；3. 不兼容ASCII，有字节序（大端/小端）问题。 | Windows系统、Java语言                 |
| UTF-32          | 定长编码（固定4字节） | 1. 所有字符均用4字节，直接对应Unicode码点；2. 极度浪费内存（如“A”也占4字节）。 | 极少数底层开发场景                    |

## 三、文件编码（硬盘存储的“翻译手册”）

- **本质**：定义“人类可读字符 ↔ 硬盘字节序列”的双向映射规则，即选择哪套编码（UTF-8/GBK/ASCII）存储文件。

- **常见文件编码对比**：
        

  - UTF-8：现代首选，兼容ASCII、支持所有字符、跨平台无乱码；

  - GBK：中文专用，1字节存英文、2字节存中文，仅Windows兼容，跨平台易乱码；

  - ASCII：仅英文，老文件场景，无法存中文。

- **例子**：字符“测试A”按不同编码存储的字节差异：
        

  - UTF-8：230 136 145 232 164 167 65（3+3+1字节）；

  - GBK：196 227 184 178 65（2+2+1字节）；

  - ASCII：乱码（中文替换为“？”）。

## 四、编程语言源码编码（编译器的“解析规则”）

### 1. 早期语言问题

C语言、Python2等默认用ASCII解析源码，导致源码中无法写中文注释/变量名，否则编译器解析字节时因无对应规则而报错/乱码。

### 2. 现代语言规范（以Go为例）

- **核心规定**：现代语言（Go、Python3、Java）均强制/默认要求源码文件以UTF-8编码保存，编译器仅按UTF-8解析字节。

- **Go语言实操**：
        

  - 源码存为UTF-8：编译器可正确解析中文注释、中文变量名、Emoji变量名；

  - 源码存为非UTF-8（如GBK）：编译器报错“illegal UTF-8 encoding”，无法运行。

- **为什么选UTF-8**：兼容老英文源码、支持全球字符、跨平台统一无乱码。

## 五、Go语言与编码的关联（byte/rune的角色）

- **byte**：uint8别名（1字节），对应UTF-8编码的单个字节，适合处理ASCII字符或UTF-8字节流；

- **rune**：int32别名（4字节），对应Unicode完整码点，可表示所有字符（无论UTF-8编码占几字节）；

- **字符串底层**：Go字符串本质是UTF-8编码的byte数组，如“中”→[]byte{228, 184, 173}。

## 六、核心总结与实用提示

### 1. 核心区别与联系

| 概念     | 本质                      | 核心作用                       |
| -------- | ------------------------- | ------------------------------ |
| Unicode  | 字符-码点映射表（身份证） | 统一全球字符编号，解决乱码根源 |
| UTF-8    | 码点转字节的规则          | 将Unicode码点转为电脑可存字节  |
| 文件编码 | 文件存储的编码选择        | 决定字符如何以字节形式存在硬盘 |
| 源码编码 | 编译器的解析规则          | 确保编译器正确识别源码中的字符 |

### 2. 实用提示

- 所有源码文件一律存为UTF-8编码，避免跨平台/编译器解析问题；

- 查看文件编码：Linux用`file 文件名`，Windows用Notepad++（编码→查看编码）；

- Go中遍历字符串：for循环按byte遍历（UTF-8字节），for range按rune遍历（完整字符）。

