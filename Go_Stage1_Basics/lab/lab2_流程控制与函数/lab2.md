# å®éªŒ 2: The Functional Battle Engine (å‡½æ•°å¼æˆ˜æ–—å¼•æ“)

**å®éªŒç›®æ ‡**ï¼šä¸ä½¿ç”¨ `struct`ï¼ˆç»“æ„ä½“å°†åœ¨ Stage 3 å­¦ä¹ ï¼‰ï¼Œä»…é **å‡½æ•°**å’Œ**é—­åŒ…**æ¥å®ç°ä¸€ä¸ªæ‹¥æœ‰çŠ¶æ€è®°å¿†çš„æˆ˜æ–—ç³»ç»Ÿã€‚

## ğŸ“ å®éªŒå‰ç½®å‡†å¤‡

è¯·æ–°å»ºæ–‡ä»¶ `lab2.go`ï¼Œå¹¶å†™å…¥åŸºç¡€åŒ…å£°æ˜ã€‚

------

## âš”ï¸ ä»»åŠ¡ä¸€ï¼šé—­åŒ…å·¥å‚â€”â€”æŠ€èƒ½ç”Ÿæˆå™¨ (The Skill Generator)

åœ¨ C++ é‡Œï¼Œä½ å¯èƒ½ä¼šå†™ä¸€ä¸ª `Skill` ç±»ï¼Œé‡Œé¢æœ‰ä¸€ä¸ª `int cooldown` æˆå‘˜å˜é‡ã€‚ä½†åœ¨ Go çš„å‡½æ•°å¼ç¼–ç¨‹ä¸­ï¼Œæˆ‘ä»¬è¦ç”¨**é—­åŒ…**æ¥å®ç°ã€‚

**éœ€æ±‚ï¼š** ç¼–å†™ä¸€ä¸ªå‡½æ•° `createSkill(baseDamage int)`ï¼Œå®ƒè¿”å›ä¸¤ä¸ªå‡½æ•°ï¼ˆæ²¡é”™ï¼ŒGoæ”¯æŒå¤šè¿”å›å€¼ï¼‰ï¼š

1. `trigger func() (int, bool)`: é‡Šæ”¾æŠ€èƒ½å‡½æ•°ã€‚
   - è¿”å›é€ æˆçš„ä¼¤å®³(int)å’Œæ˜¯å¦é‡Šæ”¾æˆåŠŸ(bool)ã€‚
   - **æœºåˆ¶**ï¼šæŠ€èƒ½æœ‰ **3å›åˆ** çš„å†·å´æ—¶é—´ã€‚
   - ç¬¬1æ¬¡è°ƒç”¨ï¼šæˆåŠŸï¼Œè¿”å› `baseDamage`ï¼Œå†·å´ç½®ä¸º 3ã€‚
   - ç¬¬2ã€3ã€4æ¬¡è°ƒç”¨ï¼šå¤±è´¥ï¼ˆå†·å´ä¸­ï¼‰ï¼Œè¿”å› 0 å’Œ falseï¼Œå†·å´è®¡æ•°å™¨å‡ 1ã€‚
   - ç¬¬5æ¬¡è°ƒç”¨ï¼šæˆåŠŸï¼ˆå†·å´ç»“æŸï¼‰ï¼Œé€»è¾‘åŒç¬¬1æ¬¡ã€‚
2. `name string`: æŠ€èƒ½åå­—ï¼ˆä¸ºäº†ç®€å•ï¼Œç›´æ¥è¿”å›å­—ç¬¦ä¸²å³å¯ï¼Œæˆ–è€…ä½ ä¹Ÿå¯ä»¥æŠŠåå­—åšè¿›é—­åŒ…é‡Œï¼‰ã€‚

**C++ æ€è€ƒé¢˜**ï¼šè¿™é‡Œçš„å†·å´è®¡æ•°å™¨å˜é‡å­˜åœ¨å“ªé‡Œï¼Ÿå †ä¸Šè¿˜æ˜¯æ ˆä¸Šï¼Ÿï¼ˆæç¤ºï¼šé€ƒé€¸åˆ†æï¼‰

------

## ğŸ›¡ï¸ ä»»åŠ¡äºŒï¼šä¼¤å®³ç®¡é“â€”â€”å‡½æ•°ä½œä¸ºå‚æ•° (Damage Pipeline)

ç¼–å†™ä¸€ä¸ªé€šç”¨çš„ä¼¤å®³å¤„ç†å‡½æ•° `applyDamage`ï¼Œå®ƒä¸ç›´æ¥è®¡ç®—æœ€ç»ˆä¼¤å®³ï¼Œè€Œæ˜¯ä¾èµ–ä¼ å…¥çš„â€œè§„åˆ™å‡½æ•°â€ã€‚

**éœ€æ±‚ï¼š**

1. å®šä¹‰å‡½æ•° `applyDamage(damage int, modifier func(int) int) int`ã€‚
2. åœ¨ `main` ä¸­å®šä¹‰å‡ ç§ modifier ç­–ç•¥ï¼ˆåŒ¿åå‡½æ•°ï¼‰ï¼š
   - **æš´å‡»ç­–ç•¥**ï¼šå¦‚æœä¼¤å®³å¤§äº 10ï¼Œåˆ™ç¿»å€ï¼›å¦åˆ™ä¸å˜ã€‚
   - **æ ¼æŒ¡ç­–ç•¥**ï¼šå›ºå®šå‡å… 5 ç‚¹ä¼¤å®³ï¼ˆæœ€ä½ä¸º0ï¼‰ã€‚
3. æ¼”ç¤ºå¦‚ä½•å°†è¿™äº›ç­–ç•¥ä¼ ç»™ `applyDamage`ã€‚

------

## ğŸ”„ ä»»åŠ¡ä¸‰ï¼šæ ¸å¿ƒå¾ªç¯â€”â€”å¸¦ Label çš„æˆ˜æ–—é€»è¾‘

æ¨¡æ‹Ÿä¸€åœºâ€œä½  vs Bossâ€çš„æˆ˜æ–—ã€‚

**éœ€æ±‚ï¼š**

1. ä½¿ç”¨ `for` æ­»å¾ªç¯ä½œä¸ºæ¸¸æˆä¸»å¾ªç¯ã€‚
2. ä½¿ç”¨ `switch` å¤„ç†ç©å®¶æŒ‡ä»¤ï¼ˆ"attack", "heal", "run"ï¼‰ã€‚
3. **æ ¸å¿ƒéš¾ç‚¹ï¼ˆLabel ä½¿ç”¨ï¼‰**ï¼š
   - Boss æœ‰ä¸€ä¸ªâ€œåä¼¤é£æš´â€æŠ€èƒ½ã€‚
   - å½“ç©å®¶é€‰æ‹© "attack" æ—¶ï¼Œè¿›å…¥ä¸€ä¸ªå†…å±‚ `for` å¾ªç¯ï¼ˆæ¨¡æ‹Ÿ 3 è¿å‡»ï¼‰ã€‚
   - åœ¨è¿å‡»è¿‡ç¨‹ä¸­ï¼Œå¦‚æœè§¦å‘äº† Boss çš„åä¼¤ï¼ˆæ¨¡æ‹Ÿä¸€ä¸ªéšæœºæ•°æˆ–ç‰¹å®šæ¡ä»¶ï¼‰ï¼Œå¯¼è‡´ç©å®¶è¡€é‡å½’é›¶ï¼Œ**å¿…é¡»ä½¿ç”¨ `break Label` ç›´æ¥è·³å‡ºæœ€å¤–å±‚çš„æ¸¸æˆä¸»å¾ªç¯**ï¼Œå¹¶æ‰“å° "Game Over"ã€‚

------

## ğŸ’» å®éªŒä»£ç æ¡†æ¶ (Skeleton Code)

ä¸ºäº†è®©ä½ ä¸“æ³¨äºé€»è¾‘ï¼Œæˆ‘æä¾›äº†è„šæ‰‹æ¶ã€‚**æç¤ºï¼šéœ€è¦æ›´æ”¹ï¼ï¼ï¼ï¼Œè¯·æ ¹æ®è‡ªå·±åˆ¶å®šçš„æ¸¸æˆç­–ç•¥å®Œå–„æˆçµæ´»çš„ã€å¯è¿è¡Œçš„ç¨‹åº**

Go

```
package main

import (
	"fmt"
)

// ---------------------- ä»»åŠ¡ä¸€ï¼šé—­åŒ…æŠ€èƒ½å·¥å‚ ----------------------

// createFireball è¿”å›ä¸€ä¸ªé—­åŒ…å‡½æ•°ã€‚
// è¿™é‡Œçš„é€»è¾‘æ˜¯ï¼šæ¨¡æ‹Ÿä¸€ä¸ªå¸¦å†·å´æ—¶é—´(CD)çš„æŠ€èƒ½ã€‚
// è®¾å®šï¼šCDä¸º 3 å›åˆã€‚
// è¿”å›å€¼: (é‡Šæ”¾å‡½æ•°, æŠ€èƒ½å)
// é‡Šæ”¾å‡½æ•°ç­¾å: func() (damage int, success bool)
func createFireball(baseDamage int) (func() (int, bool), string) {
	// TODO: åœ¨è¿™é‡Œå®šä¹‰ä¸€ä¸ªå±€éƒ¨å˜é‡æ¥è®°å½•å†·å´å›åˆæ•° (captured variable)
	// cd := 0

	// è¿”å›é—­åŒ…
	return func() (int, bool) {
		// TODO: ç¼–å†™é€»è¾‘
		// 1. å¦‚æœ cd > 0ï¼Œè¯´æ˜åœ¨å†·å´ä¸­ï¼Œcdå‡1ï¼Œè¿”å› 0, false
		// 2. å¦‚æœ cd == 0ï¼Œè¯´æ˜å¯ä»¥é‡Šæ”¾ï¼Œå°† cd é‡ç½®ä¸º 3ï¼Œè¿”å› baseDamage, true
		return 0, false // å ä½ç¬¦
	}, "çˆ†è£‚ç«çƒ"
}

// ---------------------- ä»»åŠ¡äºŒï¼šä¼¤å®³è®¡ç®—å™¨ ----------------------

// è¿™æ˜¯ä¸€ä¸ªé«˜é˜¶å‡½æ•°ï¼Œå®ƒæ¥å—ä¸€ä¸ªå‡½æ•°ä½œä¸ºå‚æ•° modifier
func applyDamage(rawDamage int, modifier func(int) int) int {
	// TODO: ä½¿ç”¨ modifier å¤„ç† rawDamage å¹¶è¿”å›
	return 0
}

// ---------------------- ä»»åŠ¡ä¸‰ï¼šä¸»é€»è¾‘ ----------------------

func main() {
	// 1. åˆå§‹åŒ–
	hp := 100
	bossHp := 1000
	
	// è·å–æŠ€èƒ½é—­åŒ… (æ³¨æ„ï¼šfireballFunc å†…éƒ¨ç°åœ¨å·²ç»æ‹¥æœ‰äº†ä¸€ä¸ªä¸“å±çš„ cd å˜é‡)
	fireballFunc, skillName := createFireball(50)

	fmt.Println("=== æˆ˜æ–—å¼€å§‹ ===")
    
    // å®šä¹‰ä¸€ä¸ª Labelï¼Œç”¨äºåœ¨æ„å¤–æ­»äº¡æ—¶ç›´æ¥è·³å‡ºæ•´ä¸ªæˆ˜æ–—
BattleLoop:
	for round := 1; ; round++ {
		fmt.Printf("\n--- ç¬¬ %d å›åˆ (HP: %d) ---\n", round, hp)
		fmt.Println("è¯·é€‰æ‹©æŒ‡ä»¤: 1.æ”»å‡»(Attack)  2.é€ƒè·‘(Run)")
		
		var choice int
		// ä¸ºäº†æ–¹ä¾¿æµ‹è¯•ï¼Œä½ å¯ä»¥è¿™é‡Œæ‰‹åŠ¨æ”¹ choiceï¼Œæˆ–è€…ç”¨ fmt.Scan(&choice)
		// è¿™é‡Œæˆ‘ä»¬åœ¨ä»£ç é‡Œæ¨¡æ‹Ÿè¾“å…¥ï¼Œå‡è®¾å‰å‡ å›åˆä¸€ç›´æ”»å‡»
		if round < 6 {
			choice = 1 
		} else {
			choice = 2
		}

		// é€»è¾‘åˆ¤æ–­
		switch choice {
		case 1: // æ”»å‡»
			fmt.Println("ä½ å‘èµ·äº†æ”»å‡»ï¼å‡†å¤‡è¿›è¡Œ 3 è¿å‡»...")

			// å†…å±‚å¾ªç¯ï¼šæ¨¡æ‹Ÿå¤šæ®µæ”»å‡»
			for hit := 1; hit <= 3; hit++ {
				// å°è¯•é‡Šæ”¾æŠ€èƒ½ (åˆ©ç”¨é—­åŒ…çŠ¶æ€)
				dmg, success := fireballFunc()
				
				if success {
					// æˆåŠŸé‡Šæ”¾ï¼Œåº”ç”¨æš´å‡»ç­–ç•¥ (åŒ¿åå‡½æ•°ä½œä¸ºå‚æ•°)
					finalDmg := applyDamage(dmg, func(d int) int {
						// TODO: å¦‚æœ d > 40ï¼Œè¿”å› d * 2 (æš´å‡»)ï¼Œå¦åˆ™è¿”å› d
						return d 
					})
					bossHp -= finalDmg
					fmt.Printf("  [ç¬¬%då‡»] %s é‡Šæ”¾æˆåŠŸï¼é€ æˆ %d ç‚¹ä¼¤å®³ (Bosså‰©ä½™: %d)\n", hit, skillName, finalDmg, bossHp)
				} else {
					fmt.Printf("  [ç¬¬%då‡»] %s å†·å´ä¸­... æ— æ³•é‡Šæ”¾\n", hit, skillName)
				}

				// æ¨¡æ‹Ÿ Boss åä¼¤ (å‡è®¾ç¬¬ 3 å›åˆçš„ç¬¬ 2 å‡»ä¼šè§¦å‘è‡´å‘½åä¼¤)
				if round == 3 && hit == 2 {
					fmt.Println("âš ï¸ è­¦å‘Šï¼šè§¦å‘ Boss åä¼¤é£æš´ï¼")
					hp = 0
					// TODO: åœ¨è¿™é‡Œä½¿ç”¨ break Label å½»åº•ç»“æŸæˆ˜æ–—
					// ???
				}
			}

		case 2: // é€ƒè·‘
			fmt.Println("ä½ é€ƒè·‘äº†ï¼")
			break BattleLoop // è·³å‡ºä¸»å¾ªç¯

		default:
			fmt.Println("æ— æ•ˆæŒ‡ä»¤ï¼Œè·³è¿‡æœ¬å›åˆ")
		}

		// æ£€æŸ¥ Boss æ˜¯å¦æ­»äº¡
		if bossHp <= 0 {
			fmt.Println("ğŸ† èƒœåˆ©ï¼Boss è¢«å‡»è´¥ï¼")
			break // æ™®é€š break å³å¯
		}
	}

	if hp <= 0 {
		fmt.Println("ğŸ’€ Game Over... ä½ è¢«æ‰“è´¥äº†ã€‚")
	} else {
		fmt.Println("æˆ˜æ–—ç»“æŸï¼Œè‹±é›„å­˜æ´»ã€‚")
	}
}
```

------

## ğŸ§ æ·±åº¦æ€è€ƒé¢˜ (å†™åœ¨ä»£ç æ³¨é‡Šé‡Œ)

1. åœ¨ `createFireball` é—­åŒ…é‡Œä¿®æ”¹çš„é‚£ä¸ª `cd` å˜é‡ï¼Œå½“ `main` å‡½æ•°æ‰§è¡Œå®Œç¬¬ä¸€å›åˆåï¼Œå®ƒé”€æ¯äº†å—ï¼Ÿä¸ºä»€ä¹ˆï¼Ÿ
2. å¦‚æœåœ¨ `switch` çš„ `case 1` é‡Œç›´æ¥å†™ `break`ï¼Œä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿå®ƒèƒ½è·³å‡º `BattleLoop` å—ï¼Ÿ